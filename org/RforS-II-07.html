<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-24 月 10:39 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>7章 分散分析</title>
<meta name="author" content="suzuki@iwate-u.ac.jp 鈴木正幸，非常勤講師" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">7章 分散分析</h1>


<div id="outline-container-org539190a" class="outline-2">
<h2 id="org539190a">7.0 分散分析 (anova, Analysis Of Variance)</h2>
<div class="outline-text-2" id="text-org539190a">
<p>
3つ以上の <b>平均値を比較する</b> ために，分散分析を紹介する
</p>

<ul class="org-ul">
<li>分散分析の考え方の基礎，「平方和の分解」
<ul class="org-ul">
<li>要因の数の違い，</li>
<li>標本の対応の有無による違い，がある</li>
</ul></li>
</ul>
</div>

<div id="outline-container-org1ebd14e" class="outline-4">
<h4 id="org1ebd14e">変動の区別</h4>
<div class="outline-text-4" id="text-org1ebd14e">
</div>
<div id="outline-container-org9854f6a" class="outline-5">
<h5 id="org9854f6a">全体の変動</h5>
<div class="outline-text-5" id="text-org9854f6a">
<ul class="org-ul">
<li>全データをまとめて扱う</li>
<li>全平均 と 個々のデータの偏差，分散</li>
</ul>
</div>
</div>

<div id="outline-container-org2b53e29" class="outline-5">
<h5 id="org2b53e29">方法 (要因) の違いによる変動</h5>
<div class="outline-text-5" id="text-org2b53e29">
<ul class="org-ul">
<li>方法ごとにグループを作成</li>
<li>全平均 と グループ内平均との偏差，分散</li>
<li id="水準">同じ方法で処方レベルの違い</li>
</ul>
</div>
</div>

<div id="outline-container-orge378171" class="outline-5">
<h5 id="orge378171">個の違いによる変動 (誤差)</h5>
<div class="outline-text-5" id="text-orge378171">
<ul class="org-ul">
<li>同じ方法グループ内のデータの変動は，個々の違いが原因。</li>
<li>方法の効果を見るためには，雑音と考える。</li>
</ul>
</div>
</div>

<div id="outline-container-orgb45aa66" class="outline-5">
<h5 id="orgb45aa66">分散分析</h5>
<div class="outline-text-5" id="text-orgb45aa66">
<p>
全体の変動 = 方法 (要因)による変動 + 個の違いによる変動 となる。
</p>



<p>
要因毎にわけ，誤差に較べて大きな影響を与えている要因を探す。
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org4dad295" class="outline-2">
<h2 id="org4dad295">7.1 一元配置分散分析</h2>
<div class="outline-text-2" id="text-org4dad295">
<p>
一つの要因の分析を行なう。
</p>
</div>

<div id="outline-container-org425a544" class="outline-4">
<h4 id="org425a544"><a href="RforS-II-07-data.html#MissingReference">指導法データの準備</a></h4>
<div class="outline-text-4" id="text-org425a544">
<div class="org-src-container">
<pre class="src src-R">
(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479; <span style="color: #e5786d;">&lt;-</span> read.csv(<span style="color: #95e454;">"data/shidouhouU8.csv"</span>))
class(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;)
str(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;)

</pre>
</div>

<pre class="example" id="org2f868aa">
   SID   name sex math stat psych_test stat_test1 stat_test2 method
1    1   大村  男 嫌い 好き         13          6         10      C
2    2   本多  男 嫌い 好き         14         10         13      B
3    3   川崎  男 好き 好き          7          6          8      B
4    4   多村  男 好き 好き         12         10         15      A
5    5   松中  男 嫌い 嫌い         10          5          8      B
6    6 小久保  男 嫌い 嫌い          6          3          6      C
7    7   柴原  男 嫌い 嫌い          8          5          9      A
8    8   井手  男 嫌い 嫌い         15          9         10      D
9    9   田上  男 嫌い 嫌い          4          3          7      D
10  10   松田  男 好き 嫌い         14          3          3      D
11  11   高谷  女 好き 好き          9         11         18      A
12  12   杉内  女 嫌い 好き          6          6         14      A
13  13   和田  女 好き 好き         10         11         18      A
14  14   新垣  女 嫌い 嫌い         12          9         11      C
15  15   大隣  女 嫌い 好き          5          7         12      B
16  16   水田  女 好き 嫌い         12          5          5      D
17  17   斉藤  女 嫌い 嫌い          8          8          7      C
18  18   柳瀬  女 嫌い 嫌い          8          7         12      C
19  19   佐藤  女 嫌い 嫌い         12          7          7      B
20  20   馬原  女 嫌い 嫌い         15          9          7      D
[1] "data.frame"
'data.frame':	20 obs. of  9 variables:
 $ SID       : int  1 2 3 4 5 6 7 8 9 10 ...
 $ name      : Factor w/ 20 levels "井手","高谷",..: 14 18 12 13 6 5 4 1 16 7 ...
 $ sex       : Factor w/ 2 levels "女","男": 2 2 2 2 2 2 2 2 2 2 ...
 $ math      : Factor w/ 2 levels "嫌い","好き": 1 1 2 2 1 1 1 1 1 2 ...
 $ stat      : Factor w/ 2 levels "嫌い","好き": 2 2 2 2 1 1 1 1 1 1 ...
 $ psych_test: int  13 14 7 12 10 6 8 15 4 14 ...
 $ stat_test1: int  6 10 6 10 5 3 5 9 3 3 ...
 $ stat_test2: int  10 13 8 15 8 6 9 10 7 3 ...
 $ method    : Factor w/ 4 levels "A","B","C","D": 3 2 2 1 2 3 1 4 4 4 ...
</pre>

<div class="org-src-container">
<pre class="src src-R">
(As <span style="color: #e5786d;">&lt;-</span> subset(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;, method==<span style="color: #95e454;">"A"</span>)$stat_test2)
(Bs <span style="color: #e5786d;">&lt;-</span> subset(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;, method==<span style="color: #95e454;">"B"</span>)$stat_test2)
(Cs <span style="color: #e5786d;">&lt;-</span> subset(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;, method==<span style="color: #95e454;">"C"</span>)$stat_test2)
(Ds <span style="color: #e5786d;">&lt;-</span> subset(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;, method==<span style="color: #95e454;">"D"</span>)$stat_test2)

(&#32113;&#35336;&#12486;&#12473;&#12488;2 <span style="color: #e5786d;">&lt;-</span> c(As, Bs, Cs, Ds))

(&#25351;&#23566;&#27861; <span style="color: #e5786d;">&lt;-</span> c(rep(<span style="color: #95e454;">"A"</span>,5),rep(<span style="color: #95e454;">"B"</span>,5),rep(<span style="color: #95e454;">"C"</span>,5),rep(<span style="color: #95e454;">"D"</span>,5)))
(&#25351;&#23566;&#27861;2 <span style="color: #e5786d;">&lt;-</span> factor(&#25351;&#23566;&#27861;))                <span style="color: #99968b;"># </span><span style="color: #99968b;">&#35201;&#22240;&#22411;&#12505;&#12463;&#12488;&#12523;&#12395;&#22793;&#25563;</span>

</pre>
</div>

<pre class="example">
[1] 15  9 18 14 18
[1] 13  8  8 12  7
[1] 10  6 11  7 12
[1] 10  7  3  5  7
 [1] 15  9 18 14 18 13  8  8 12  7 10  6 11  7 12 10  7  3  5  7
 [1] "A" "A" "A" "A" "A" "B" "B" "B" "B" "B" "C" "C" "C" "C" "C" "D" "D" "D" "D"
[20] "D"
 [1] A A A A A B B B B B C C C C C D D D D D
Levels: A B C D
</pre>



<p>
指導法を受けている全ての人を母集団とし，その母集団において，指導法ごと
に求めたテスト得点の平均値に違いがあるかを知りたい。
</p>

<p>
この20人のデータは，母集団からの無作為抽出標本です。
</p>

<p>
この標本が，母平均の等しい4群 (A,B,C,Dの指導法ごとの) から抽出された可
能性が高いかを検討する。
</p>

<p>
そのための検定が，*分散分析* です。
</p>
</div>
</div>

<div id="outline-container-org37160f6" class="outline-4">
<h4 id="org37160f6">検定の流れ</h4>
<div class="outline-text-4" id="text-org37160f6">
</div>
<div id="outline-container-orgf823a99" class="outline-5">
<h5 id="orgf823a99">帰無仮説と対立仮説の設定</h5>
<div class="outline-text-5" id="text-orgf823a99">
<dl class="org-dl">
<dt>帰無仮説 \(H_0\)</dt><dd>4群の母平均は等しい</dd>

<dt>対立仮説 \(H_2\)</dt><dd>4群の母平均は等しくない</dd>
</dl>
</div>
</div>

<div id="outline-container-org59c3fe5" class="outline-5">
<h5 id="org59c3fe5">検定統計量</h5>
<div class="outline-text-5" id="text-org59c3fe5">
<p>
\(
	 F = \frac { \mbox{群間平方和} / \mbox{群間の自由度} }
  	           { \mbox{群内平方和} / \mbox{群内の自由度} }
	 \)
</p>

<p>
\( F \) は，全ての群の母平均が等しいときに，* F分布 * に従う
</p>

<dl class="org-dl">
<dt>群間平方和</dt><dd>全体平均値と群間平均値の差の2乗和, 自由度 (4ー1)</dd>
<dt>群内平方和</dt><dd>群内平均値との差の2乗和， 自由度 4*(5ー1)</dd>
</dl>
</div>

<div id="outline-container-orga30a877" class="outline-6">
<h6 id="orga30a877">F-分布の確率密度関数</h6>
<div class="outline-text-6" id="text-orga30a877">
<div class="org-src-container">
<pre class="src src-R">curve(df(x, 3, 16),0, 5)
</pre>
</div>


<div id="org0b4581c" class="figure">
<p><img src="./RforS/graph/f.png" alt="f.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org0c838d4" class="outline-5">
<h5 id="org0c838d4">有意水準 \(\alpha\) の決定</h5>
<div class="outline-text-5" id="text-org0c838d4">
<p>
\( \alpha=0.05 \) の片側検定， F値は正値。
</p>
</div>
</div>

<div id="outline-container-orgd23e014" class="outline-5">
<h5 id="orgd23e014">統計検定量の実現値の計算</h5>
<div class="outline-text-5" id="text-orgd23e014">
<dl class="org-dl">
<dt>oneway.test 関数</dt><dd><p>
一元配置分散分析のみ実行可能
</p>

<div class="org-src-container">
<pre class="src src-R">
<span style="color: #99968b;"># </span><span style="color: #99968b;">var.equal=TRUE&#12395;&#12424;&#12426;&#27597;&#20998;&#25955;&#12398;&#31561;&#36074;&#24615;&#12434;&#20206;&#23450;</span>
oneway.test(&#32113;&#35336;&#12486;&#12473;&#12488;2 ~ &#25351;&#23566;&#27861;2, var.equal=<span style="color: #92a65e; font-weight: bold;">TRUE</span> )

</pre>
</div>

<pre class="example">

	One-way analysis of means

data:  統計テスト2 and 指導法2
F = 7.1111, num df = 3, denom df = 16, p-value = 0.002988
</pre>


<p>
p-値が，0.002988 であるので，帰無仮説を棄却。  
</p></dd>

<dt>aov 関数</dt><dd><p>
最も一般的
</p>

<div class="org-src-container">
<pre class="src src-R">
 aov(&#32113;&#35336;&#12486;&#12473;&#12488;2 ~ &#25351;&#23566;&#27861;2)

</pre>
</div>

<pre class="example" id="org7dfc67d">
  Call:
     aov(formula = 統計テスト2 ~ 指導法2)

  Terms:
		  指導法2 Residuals
  Sum of Squares      184       138
  Deg. of Freedom       3        16

  Residual standard error: 2.936835
  Estimated effects may be unbalanced
</pre>

<div class="org-src-container">
<pre class="src src-R">
summary(aov(&#32113;&#35336;&#12486;&#12473;&#12488;2 ~ &#25351;&#23566;&#27861;2))

</pre>
</div>

<pre class="example">

	One-way analysis of means

data:  統計テスト2 and 指導法2
F = 7.1111, num df = 3, denom df = 16, p-value = 0.002988
</pre>


<p>
p-値が，0.002988 であるので，帰無仮説を棄却。  
</p></dd>

<dt>anova関数</dt><dd><p>
複数のモデルの比較など，高度な分析に対応
</p>

<div class="org-src-container">
<pre class="src src-R">
anova(lm(&#32113;&#35336;&#12486;&#12473;&#12488;2 ~ &#25351;&#23566;&#27861;2))

</pre>
</div>

<pre class="example">
Analysis of Variance Table

Response: 統計テスト2
          Df Sum Sq Mean Sq F value   Pr(&gt;F)   
指導法2    3    184  61.333  7.1111 0.002988 **
Residuals 16    138   8.625                    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>


<p>
p-値が，0.002988 であるので，帰無仮説を棄却。
</p></dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-org7d0d2fa" class="outline-4">
<h4 id="org7d0d2fa">Rによる変動と検定値の計算</h4>
<div class="outline-text-4" id="text-org7d0d2fa">
<div class="org-src-container">
<pre class="src src-R">(&#20840;&#12487;&#12540;&#12479; <span style="color: #e5786d;">&lt;-</span> cbind(As, Bs, Cs, Ds))
</pre>
</div>

<pre class="example">
     As Bs Cs Ds
[1,] 15 13 10 10
[2,]  9  8  6  7
[3,] 18  8 11  3
[4,] 14 12  7  5
[5,] 18  7 12  7
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#32676;&#24179;&#22343; <span style="color: #e5786d;">&lt;-</span> colMeans(&#20840;&#12487;&#12540;&#12479;))      <span style="color: #99968b;"># </span><span style="color: #99968b;">&#27700;&#28310;&#12372;&#12392;&#12398;&#24179;&#22343;&#12398;&#12505;&#12463;&#12488;&#12523;</span>
</pre>
</div>

<pre class="example">
  As   Bs   Cs   Ds 
14.8  9.6  9.2  6.4
</pre>


<div class="org-src-container">
<pre class="src src-R"><span style="color: #99968b;"># </span><span style="color: #99968b;">&#27700;&#28310;&#12372;&#12392;&#12398;&#24179;&#22343;&#12398;&#12505;&#12463;&#12488;&#12523;&#12434;&#34892;&#25968;&#12384;&#12369;&#20006;&#12409;&#12383;&#34892;&#21015;&#12434;&#20316;&#12427;</span>
(&#32676;&#24179;&#22343;&#34892;&#21015; <span style="color: #e5786d;">&lt;-</span> matrix(rep(&#32676;&#24179;&#22343;, nrow(&#20840;&#12487;&#12540;&#12479;)), nrow=nrow(&#20840;&#12487;&#12540;&#12479;), 
                     ncol=ncol(&#20840;&#12487;&#12540;&#12479;),byrow=<span style="color: #92a65e; font-weight: bold;">TRUE</span>))
</pre>
</div>

<pre class="example">
     [,1] [,2] [,3] [,4]
[1,] 14.8  9.6  9.2  6.4
[2,] 14.8  9.6  9.2  6.4
[3,] 14.8  9.6  9.2  6.4
[4,] 14.8  9.6  9.2  6.4
[5,] 14.8  9.6  9.2  6.4
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#32676;&#38291; <span style="color: #e5786d;">&lt;-</span> &#32676;&#24179;&#22343;&#34892;&#21015; - mean(&#20840;&#12487;&#12540;&#12479;))
</pre>
</div>

<pre class="example">
     [,1] [,2] [,3] [,4]
[1,]  4.8 -0.4 -0.8 -3.6
[2,]  4.8 -0.4 -0.8 -3.6
[3,]  4.8 -0.4 -0.8 -3.6
[4,]  4.8 -0.4 -0.8 -3.6
[5,]  4.8 -0.4 -0.8 -3.6
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#32676;&#20869; <span style="color: #e5786d;">&lt;-</span> &#20840;&#12487;&#12540;&#12479; - &#32676;&#24179;&#22343;&#34892;&#21015;)  <span style="color: #99968b;"># </span><span style="color: #99968b;">&#21508;&#12487;&#12540;&#12479;&#12392;&#12289;&#12381;&#12398;&#32676;&#20869;&#12398;&#24179;&#22343;&#12392;&#12398;&#24046;</span>
</pre>
</div>

<pre class="example">
       As   Bs   Cs   Ds
[1,]  0.2  3.4  0.8  3.6
[2,] -5.8 -1.6 -3.2  0.6
[3,]  3.2 -1.6  1.8 -3.4
[4,] -0.8  2.4 -2.2 -1.4
[5,]  3.2 -2.6  2.8  0.6
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#32676;&#20869;&#24179;&#26041;&#21644; <span style="color: #e5786d;">&lt;-</span> sum(&#32676;&#20869;^2))               <span style="color: #99968b;"># </span><span style="color: #99968b;">&#12288;&#32676;&#20869;&#24179;&#26041;&#21644;</span>
</pre>
</div>

<pre class="example">
[1] 138
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#32676;&#38291;&#24179;&#26041;&#21644; <span style="color: #e5786d;">&lt;-</span> sum(&#32676;&#38291;^2))               <span style="color: #99968b;"># </span><span style="color: #99968b;">&#12288;&#32676;&#20869;&#24179;&#26041;&#21644;</span>
</pre>
</div>

<pre class="example">
[1] 184
</pre>


<div class="org-src-container">
<pre class="src src-R">&#20998;&#27597; <span style="color: #e5786d;">&lt;-</span> &#32676;&#20869;&#24179;&#26041;&#21644; / ( (nrow(&#20840;&#12487;&#12540;&#12479;)-1)*ncol(&#20840;&#12487;&#12540;&#12479;) )

</pre>
</div>
</div>

<div id="outline-container-org97d9e98" class="outline-5">
<h5 id="org97d9e98">全体差</h5>
<div class="outline-text-5" id="text-org97d9e98">
<div class="org-src-container">
<pre class="src src-R">
(&#20840;&#20307;&#24046; <span style="color: #e5786d;">&lt;-</span> &#20840;&#12487;&#12540;&#12479; - &#20840;&#24179;&#22343;) <span style="color: #99968b;"># </span><span style="color: #99968b;">&#34892;&#21015; - &#12473;&#12459;&#12521;</span>

</pre>
</div>

<pre class="example">
     As Bs Cs Ds
[1,]  5  3  0  0
[2,] -1 -2 -4 -3
[3,]  8 -2  1 -7
[4,]  4  2 -3 -5
[5,]  8 -3  2 -3
</pre>
</div>
</div>

<div id="outline-container-org13abadf" class="outline-5">
<h5 id="org13abadf">群間差</h5>
<div class="outline-text-5" id="text-org13abadf">
<p>
群平均行列 から 全平均を引く
</p>
<div class="org-src-container">
<pre class="src src-R">
(&#32676;&#38291;&#24046; <span style="color: #e5786d;">&lt;-</span> &#32676;&#24179;&#22343;&#34892;&#21015; - &#20840;&#24179;&#22343;)
</pre>
</div>

<pre class="example">
     [,1] [,2] [,3] [,4]
[1,]  4.8 -0.4 -0.8 -3.6
[2,]  4.8 -0.4 -0.8 -3.6
[3,]  4.8 -0.4 -0.8 -3.6
[4,]  4.8 -0.4 -0.8 -3.6
[5,]  4.8 -0.4 -0.8 -3.6
</pre>
</div>
</div>

<div id="outline-container-org4fbdbf3" class="outline-5">
<h5 id="org4fbdbf3">群内差</h5>
<div class="outline-text-5" id="text-org4fbdbf3">
<p>
全データから各群内平均を引く
</p>

<div class="org-src-container">
<pre class="src src-R">
(&#32676;&#20869;&#24046; <span style="color: #e5786d;">&lt;-</span> &#20840;&#12487;&#12540;&#12479; - &#32676;&#24179;&#22343;&#34892;&#21015;)

</pre>
</div>

<pre class="example">
       As   Bs   Cs   Ds
[1,]  0.2  3.4  0.8  3.6
[2,] -5.8 -1.6 -3.2  0.6
[3,]  3.2 -1.6  1.8 -3.4
[4,] -0.8  2.4 -2.2 -1.4
[5,]  3.2 -2.6  2.8  0.6
</pre>
</div>
</div>

<div id="outline-container-orgde72a0e" class="outline-5">
<h5 id="orgde72a0e">平方</h5>
<div class="outline-text-5" id="text-orgde72a0e">
<div class="org-src-container">
<pre class="src src-R">
&#20840;&#20307;&#24046;^2
&#32676;&#38291;&#24046;^2
&#32676;&#20869;&#24046;^2

</pre>
</div>

<pre class="example" id="orge0a42d9">
     As Bs Cs Ds
[1,] 25  9  0  0
[2,]  1  4 16  9
[3,] 64  4  1 49
[4,] 16  4  9 25
[5,] 64  9  4  9
      [,1] [,2] [,3]  [,4]
[1,] 23.04 0.16 0.64 12.96
[2,] 23.04 0.16 0.64 12.96
[3,] 23.04 0.16 0.64 12.96
[4,] 23.04 0.16 0.64 12.96
[5,] 23.04 0.16 0.64 12.96
        As    Bs    Cs    Ds
[1,]  0.04 11.56  0.64 12.96
[2,] 33.64  2.56 10.24  0.36
[3,] 10.24  2.56  3.24 11.56
[4,]  0.64  5.76  4.84  1.96
[5,] 10.24  6.76  7.84  0.36
</pre>
</div>
</div>

<div id="outline-container-orgae91b20" class="outline-5">
<h5 id="orgae91b20">平方和と自由度とF-値</h5>
<div class="outline-text-5" id="text-orgae91b20">
<div class="org-src-container">
<pre class="src src-R">
&#32676;&#38291;&#24179;&#26041;&#21644; <span style="color: #e5786d;">&lt;-</span> sum(&#32676;&#38291;^2)
&#32676;&#20869;&#24179;&#26041;&#21644; <span style="color: #e5786d;">&lt;-</span> sum(&#32676;&#20869;^2)
&#20840;&#20307;&#24179;&#26041;&#21644; <span style="color: #e5786d;">&lt;-</span> &#32676;&#38291;&#24179;&#26041;&#21644; + &#32676;&#20869;&#24179;&#26041;&#21644;

(&#32676;&#38291;&#33258;&#30001;&#24230; <span style="color: #e5786d;">&lt;-</span> ncol(&#20840;&#12487;&#12540;&#12479;)-1)
(&#32676;&#20869;&#33258;&#30001;&#24230; <span style="color: #e5786d;">&lt;-</span> (nrow(&#20840;&#12487;&#12540;&#12479;)-1) * ncol(&#20840;&#12487;&#12540;&#12479;))
(&#20840;&#20307;&#33258;&#30001;&#24230; <span style="color: #e5786d;">&lt;-</span> length(&#20840;&#12487;&#12540;&#12479;)-1 )

&#20840;&#20307;&#33258;&#30001;&#24230; - &#32676;&#38291;&#33258;&#30001;&#24230; - &#32676;&#20869;&#33258;&#30001;&#24230;

(&#32676;&#38291;&#24179;&#22343;&#24179;&#26041; <span style="color: #e5786d;">&lt;-</span> &#32676;&#38291;&#24179;&#26041;&#21644;/&#32676;&#38291;&#33258;&#30001;&#24230;)
(&#32676;&#20869;&#24179;&#22343;&#24179;&#26041; <span style="color: #e5786d;">&lt;-</span> &#32676;&#20869;&#24179;&#26041;&#21644;/&#32676;&#20869;&#33258;&#30001;&#24230;)
(&#20840;&#20307;&#24179;&#22343;&#24179;&#26041; <span style="color: #e5786d;">&lt;-</span> &#20840;&#20307;&#24179;&#26041;&#21644;/&#20840;&#20307;&#33258;&#30001;&#24230;)

(F <span style="color: #e5786d;">&lt;-</span> &#32676;&#38291;&#24179;&#22343;&#24179;&#26041; / &#32676;&#20869;&#24179;&#22343;&#24179;&#26041;)

</pre>
</div>

<pre class="example">
[1] 3
[1] 16
[1] 19
[1] 0
[1] 61.33333
[1] 8.625
[1] 16.94737
[1] 7.111111
</pre>
</div>
</div>
</div>


<div id="outline-container-org46e35c8" class="outline-3">
<h3 id="org46e35c8">7.1.3 多重比較 (Tukey の方法)</h3>
<div class="outline-text-3" id="text-org46e35c8">
<p>
7.1.1項の帰無仮説の棄却では，4つの群の母平均が等しくないことは分
るが，どの群に間に差があるのかは分らない。
</p>

<p>
どの群に間に差があるのかを調べるために，* 多重比較 * とよばれる方
法を使う。
</p>

<p>
ここでは，Tukeyの方法について説明する。
</p>
</div>

<div id="outline-container-orge0742f7" class="outline-4">
<h4 id="orge0742f7">検定統計量 q</h4>
<div class="outline-text-4" id="text-orge0742f7">
<p>
各群のデータ数と分散が等しいと仮定します。
</p>

<p>
\[
      q = \frac { | \textrm{比較する群の平均値差} | } {
      \sqrt{\textrm{群内の平均平方} / \textrm{各群のデータ数} }}
      \]
</p>

<p>
((s-:)) q は t-検定(分散が同じ2群の平均値の差の検定)に似ている
</p>
</div>
</div>


<div id="outline-container-orge564177" class="outline-4">
<h4 id="orge564177">データの準備</h4>
<div class="outline-text-4" id="text-orge564177">
<div class="org-src-container">
<pre class="src src-R">
     &#25351;&#23566;&#27861;&#12487;&#12540;&#12479; <span style="color: #e5786d;">&lt;-</span> read.csv(<span style="color: #95e454;">"data/shidouhouU8.csv"</span>)

(As <span style="color: #e5786d;">&lt;-</span> subset(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;, method==<span style="color: #95e454;">"A"</span>)$stat_test2)
(Bs <span style="color: #e5786d;">&lt;-</span> subset(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;, method==<span style="color: #95e454;">"B"</span>)$stat_test2)
(Cs <span style="color: #e5786d;">&lt;-</span> subset(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;, method==<span style="color: #95e454;">"C"</span>)$stat_test2)
(Ds <span style="color: #e5786d;">&lt;-</span> subset(&#25351;&#23566;&#27861;&#12487;&#12540;&#12479;, method==<span style="color: #95e454;">"D"</span>)$stat_test2)
(&#20840;&#12487;&#12540;&#12479; <span style="color: #e5786d;">&lt;-</span> cbind(As, Bs, Cs, Ds))

     (&#25351;&#23566;&#27861; <span style="color: #e5786d;">&lt;-</span> &#25351;&#23566;&#27861;&#12487;&#12540;&#12479;$method)
     <span style="color: #99968b;"># </span><span style="color: #99968b;">(&#25351;&#23566;&#27861;2 &lt;- factor(&#25351;&#23566;&#27861;))  # &#35201;&#22240;&#12505;&#12463;&#12488;&#12523;&#12395;&#22793;&#25563;&#65292;&#36949;&#12356;&#12364;&#12394;&#12356;&#12424;&#12358;&#12394;&#12290;&#12290;&#12290;</span>
     (&#32113;&#35336;&#12486;&#12473;&#12488;2 <span style="color: #e5786d;">&lt;-</span> &#25351;&#23566;&#27861;&#12487;&#12540;&#12479;$stat_test2)

</pre>
</div>
</div>
</div>

<div id="outline-container-org711db0d" class="outline-4">
<h4 id="org711db0d">統計検定値 q の実現値値</h4>
<div class="outline-text-4" id="text-org711db0d">
<div class="org-src-container">
<pre class="src src-R">      
      (q <span style="color: #e5786d;">&lt;-</span> abs(mean(As)-mean(Ds)) / sqrt(&#32676;&#20869;&#24179;&#22343;&#24179;&#26041;/nrow(&#20840;&#12487;&#12540;&#12479;)))
      
</pre>
</div>

<pre class="example">
[1] 6.395651
</pre>
</div>
</div>

<div id="outline-container-org1e5e4b2" class="outline-4">
<h4 id="org1e5e4b2">棄却域の決定</h4>
<div class="outline-text-4" id="text-org1e5e4b2">
<p>
有意水準 5%, 平均値の数 4, 群内自由度 16，を指定します。
</p>

<div class="org-src-container">
<pre class="src src-R">
qtukey(0.95, 4, 16)
qtukey(0.05, 4, 16, lower.tail=<span style="color: #92a65e; font-weight: bold;">FALSE</span>)


</pre>
</div>

<pre class="example">
[1] 4.046093
[1] 4.046093
</pre>


<p>
どちらも4.046093となり，棄却域は \( q > 4.046093 \) となります。
</p>
</div>
</div>

<div id="outline-container-org46d8840" class="outline-4">
<h4 id="org46d8840">TukeyHSD (Honest Significant Difference)</h4>
<div class="outline-text-4" id="text-org46d8840">
<div class="org-src-container">
<pre class="src src-R">
TukeyHSD(aov(&#32113;&#35336;&#12486;&#12473;&#12488;2 ~ &#25351;&#23566;&#27861;))

</pre>
</div>

<pre class="example" id="orga94fa55">
	Tukey multiple comparisons of means
	  95% family-wise confidence level

      Fit: aov(formula = 統計テスト2 ~ 指導法)

      $指導法
	  diff        lwr        upr     p adj
      B-A -5.2 -10.514108  0.1141085 0.0562227
      C-A -5.6 -10.914108 -0.2858915 0.0371222
      D-A -8.4 -13.714108 -3.0858915 0.0017736
      C-B -0.4  -5.714108  4.9141085 0.9963241
      D-B -3.2  -8.514108  2.1141085 0.3446966
      D-C -2.8  -8.114108  2.5141085 0.4561325
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org9840ff6" class="outline-2">
<h2 id="org9840ff6">7.2 一元配置分散分析 (対応あり)</h2>
<div class="outline-text-2" id="text-org9840ff6">
<p>
一元配置分散分析 (対応あり)では、
</p>

<ul class="org-ul">
<li>同じ被験者が</li>
<li>複数の条件を経験する</li>
</ul>

<p>
などの対応のあるデータを対象とする。
</p>
</div>

<div id="outline-container-org918d31b" class="outline-4">
<h4 id="org918d31b">例題</h4>
<div class="outline-text-4" id="text-org918d31b">
<p>
以下の表は5名の学生に、線形代数、微分積分、確率統計に対する好意度
の評定データである。 これら3つの科目に対する好意度に差があるだろ
うか？（念のため：これは１要因３水準)
</p>

<table id="orgb2b9d73" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">学生</th>
<th scope="col" class="org-right">線形代数</th>
<th scope="col" class="org-right">微分積分</th>
<th scope="col" class="org-right">確率統計</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">田中</td>
<td class="org-right">7</td>
<td class="org-right">5</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-left">岸</td>
<td class="org-right">8</td>
<td class="org-right">4</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-left">大引</td>
<td class="org-right">9</td>
<td class="org-right">7</td>
<td class="org-right">7</td>
</tr>

<tr>
<td class="org-left">吉川</td>
<td class="org-right">5</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-left">荻野</td>
<td class="org-right">6</td>
<td class="org-right">3</td>
<td class="org-right">5</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orgdf60fc4" class="outline-5">
<h5 id="orgdf60fc4">対応がないものとして分散分析してみる</h5>
<div class="outline-text-5" id="text-orgdf60fc4">
</div>
<div id="outline-container-orga368ba9" class="outline-6">
<h6 id="orga368ba9">仮説</h6>
<div class="outline-text-6" id="text-orga368ba9">
<dl class="org-dl">
<dt>帰無仮説 H_0</dt><dd>3科目の好感度の母平均は等しい</dd>
<dt>対立仮説 H_1</dt><dd>3科目の好感度の母平均は等しくない</dd>
</dl>
</div>
</div>

<div id="outline-container-orgdb1d341" class="outline-6">
<h6 id="orgdb1d341">検定統計量 F ::</h6>
<div class="outline-text-6" id="text-orgdb1d341">
<p>
\[
	 F = \frac { \mbox{群間平方和} / \mbox{群間の自由度} }
	           { \mbox{群内平方和} / \mbox{群内の自由度} }
	 \]
</p>

<p>
\( F \) は，全ての群の母平均が等しいときに，* F分布 * に従う
</p>

<dl class="org-dl">
<dt>群間平方和</dt><dd>全体平均値と群間平均値の差の2乗和</dd>
<dt>群内平方和</dt><dd>群内平均値との差の2乗和</dd>
</dl>
</div>
</div>

<div id="outline-container-orgaacd781" class="outline-6">
<h6 id="orgaacd781">対応がないものとして実行</h6>
<div class="outline-text-6" id="text-orgaacd781">
<div class="org-src-container">
<pre class="src src-R">
&#22909;&#24847;&#24230; <span style="color: #e5786d;">&lt;-</span> c(7,8,9,5,6,5,4,7,1,3,8,6,7,2,5)
&#31185;&#30446; <span style="color: #e5786d;">&lt;-</span> factor(c(rep(<span style="color: #95e454;">"&#32218;&#24418;&#20195;&#25968;"</span>,5),rep(<span style="color: #95e454;">"&#24494;&#20998;&#31309;&#20998;"</span>,5),rep(<span style="color: #95e454;">"&#30906;&#29575;&#32113;&#35336;"</span>,5)))
summary(aov(&#22909;&#24847;&#24230;~&#31185;&#30446;))                    <span style="color: #99968b;"># </span><span style="color: #99968b;">&#22909;&#24847;&#24230;&#12434;&#31185;&#30446;&#12398;&#35251;&#28857;&#12363;&#12425;&#20998;&#26512;&#12377;&#12427;</span>

</pre>
</div>

<pre class="example">
            Df Sum Sq Mean Sq F value Pr(&gt;F)
科目         2  22.53  11.267   2.641  0.112
Residuals   12  51.20   4.267
</pre>
</div>
</div>

<div id="outline-container-orgc9c17bf" class="outline-6">
<h6 id="orgc9c17bf">結果</h6>
<div class="outline-text-6" id="text-orgc9c17bf">
<dl class="org-dl">
<dt>F値</dt><dd>2.641</dd>
<dt>p値</dt><dd>0.1121 &gt; 0.05</dd>
</dl>

<p>
p値か 5%水準より大きいため, 有意な差は認められない。
帰無仮説を採択。
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf6c5471" class="outline-4">
<h4 id="orgf6c5471">7.2.2 一元配置分散分析 (対応あり)の実行</h4>
<div class="outline-text-4" id="text-orgf6c5471">
</div>
<div id="outline-container-org96f578b" class="outline-5">
<h5 id="org96f578b">仮説</h5>
<div class="outline-text-5" id="text-org96f578b">
<dl class="org-dl">
<dt>帰無仮説 H_0</dt><dd>3科目の好感度の母平均は等しい</dd>
<dt>対立仮説 H_1</dt><dd>3科目の好感度の母平均は等しくない</dd>
</dl>
</div>
</div>

<div id="outline-container-org3707eaa" class="outline-5">
<h5 id="org3707eaa">検定統計量 F</h5>
<div class="outline-text-5" id="text-org3707eaa">
<p>
\[
	 F = \frac { \mbox{条件平方和} / \mbox{条件の自由度} }
	           { \mbox{残差平方和} / \mbox{残差の自由度} }
	 \]
</p>

<p>
\( F \) は，全ての群の母平均が等しいときに，* F分布 * に従う
</p>

<dl class="org-dl">
<dt>残差平方和</dt><dd>全体平均値と群間平均値の差の2乗和</dd>
<dt>条件平方和</dt><dd>群間平方和と同じ</dd>
</dl>
</div>
</div>

<div id="outline-container-org4c244ba" class="outline-5">
<h5 id="org4c244ba">検定統計量の実現値</h5>
<div class="outline-text-5" id="text-org4c244ba">
<div class="org-src-container">
<pre class="src src-R">
&#20154; <span style="color: #e5786d;">&lt;-</span> factor(rep(c(<span style="color: #95e454;">"&#30000;&#20013;"</span>,<span style="color: #95e454;">"&#23736;"</span>, <span style="color: #95e454;">"&#22823;&#24341;"</span>, <span style="color: #95e454;">"&#21513;&#24029;"</span>, <span style="color: #95e454;">"&#33833;&#37326;"</span>),3))
aov(&#22909;&#24847;&#24230; ~ &#31185;&#30446; + &#20154;)
summary(aov(&#22909;&#24847;&#24230; ~ &#31185;&#30446; + &#20154;))

</pre>
</div>

<pre class="example" id="orgb84c0f0">
Call:
   aov(formula = 好意度 ~ 科目 + 人)

Terms:
                    科目       人 Residuals
Sum of Squares  22.53333 45.06667   6.13333
Deg. of Freedom        2        4         8

Residual standard error: 0.875595
Estimated effects may be unbalanced
            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
科目         2  22.53  11.267    14.7 0.002095 ** 
人           4  45.07  11.267    14.7 0.000931 ***
Residuals    8   6.13   0.767                     
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>
</div>

<div id="outline-container-orge0ac3ae" class="outline-6">
<h6 id="orge0ac3ae">結果</h6>
<div class="outline-text-6" id="text-orge0ac3ae">
<p>
科目の違いによる平均値差の検定をおこないたかったので,
科目の行を見る:
</p>

<ul class="org-ul">
<li>F-値が14.7，</li>
<li>p-値が\( 0.002 < 0.05 \)</li>
</ul>

<p>
で，帰無仮説は棄却されます。
</p>

<p>
人の行では，
</p>
<ul class="org-ul">
<li>人による好感度の差が有意であると示されています。</li>
</ul>

<p>
Fは，分子の自由度が2, 分母の自由度が8のF-分布に従います。
</p>
</div>
</div>
</div>

<div id="outline-container-org9471bf7" class="outline-5">
<h5 id="org9471bf7">Error 項を指定した分散分析</h5>
<div class="outline-text-5" id="text-org9471bf7">
<ul class="org-ul">
<li>formula, error model などに関する説明
<ul class="org-ul">
<li><a href="https://stackoverflow.com/questions/37497948/aov-error-term-in-r-whats-the-difference-bw-errorid-and-errorid-timevar">anova - aov() error term in R: what's the difference bw Error(id) and Error(id/timevar) specification? - Stack Overflow</a></li>
<li><a href="https://cran.r-project.org/doc/contrib/manuals-jp/Mase-Rstatman.pdf">Mase-Rstatman.pdf</a> (線形回帰モデルの分散分析表)</li>
</ul></li>
</ul>

<p>
aov() 関数にあたえる formula (公式) :
</p>
<ul class="org-ul">
<li>人/科目 = 人 + 人:科目</li>
<li>人*科目 = 人 + 科目 + 人:科目</li>
<li>人:科目 は，人と科目の交互作用</li>
</ul>


<p>
Error 項を指定して分散分析を実行しても同じ結果になります:
</p>

<div class="org-src-container">
<pre class="src src-R">
summary(aov(&#22909;&#24847;&#24230; ~ &#31185;&#30446; + Error(&#20154;/&#31185;&#30446;)))

</pre>
</div>

<pre class="example" id="orgf64f645">

Error: 人
          Df Sum Sq Mean Sq F value Pr(&gt;F)
Residuals  4  45.07   11.27               

Error: 人:科目
p          Df Sum Sq Mean Sq F value Pr(&gt;F)   
科目       2 22.533  11.267    14.7 0.0021 **
Residuals  8  6.133   0.767                  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>

<div class="org-src-container">
<pre class="src src-R">
summary(aov(&#22909;&#24847;&#24230; ~ &#31185;&#30446; + &#20154; + Error(&#20154;:&#31185;&#30446;)))

</pre>
</div>

<pre class="example" id="orge1026a3">

Error: 人:科目
          Df Sum Sq Mean Sq F value   Pr(&gt;F)    
科目       2  22.53  11.267    14.7 0.002095 ** 
人         4  45.07  11.267    14.7 0.000931 ***
Residuals  8   6.13   0.767                     
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
 警告メッセージ: 
 aov(好意度 ~ 科目 + 人 + Error(人:科目)) で:  Error() model is singular
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba9c2d6" class="outline-4">
<h4 id="orgba9c2d6">7.2.3 対応の有無による違い</h4>
<div class="outline-text-4" id="text-orgba9c2d6">
<pre class="example">
            Df Sum Sq Mean Sq F value Pr(&gt;F)
科目         2  22.53  11.267   2.641  0.112
Residuals   12  51.20   4.267
</pre>



<pre class="example">
            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
科目         2  22.53  11.267    14.7 0.002095 ** 
人           4  45.07  11.267    14.7 0.000931 ***
Residuals    8   6.13   0.767                     
</pre>
</div>
</div>

<div id="outline-container-org681d4b9" class="outline-4">
<h4 id="org681d4b9">参考: 3群以上を比較するとき、2群間の検定（T検定）を使ってはいけない理由</h4>
<div class="outline-text-4" id="text-org681d4b9">
<p>
いま、A,B, Cという3つの群があったとします。そこで、2群間の検定を A-B間、
B-C間、C-AC間で有意水準5%で行ったとします。
</p>

<p>
ここで、「この組み合わせの少なくとも１つは有意差がある」 となる確率を
計算すると(実際にその間に有意差があるなしに拘らず)、 　
1-(1-0.05)*(1-0.05)*(1-0.05) = 0.14 となります。つまり、 有意水準 5%
(=0.05)で検定したつもりが、 この方法では実質的に 14 %で検定している、
つまり 検定力が低下してしまう、というのが理由です。
</p>
</div>
</div>



<div id="outline-container-orgb56aa5d" class="outline-4">
<h4 id="orgb56aa5d">Tukey の多重比較</h4>
<div class="outline-text-4" id="text-orgb56aa5d">
<div class="org-src-container">
<pre class="src src-R">
TukeyHSD(aov(&#22909;&#24847;&#24230; ~ &#31185;&#30446; + &#20154;))

</pre>
</div>

<pre class="example" id="org1100c67">
  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = 好意度 ~ 科目 + 人)

$科目
                  diff       lwr       upr     p adj
線形代数-確率統計  1.4 -0.182381  2.982381 0.0811694
微分積分-確率統計 -1.6 -3.182381 -0.017619 0.0477167
微分積分-線形代数 -3.0 -4.582381 -1.417619 0.0016141

$人
                diff        lwr        upr     p adj
岸-荻野    1.3333333 -1.1365377  3.8032044 0.4036928
吉川-荻野 -2.0000000 -4.4698711  0.4698711 0.1226987
大引-荻野  3.0000000  0.5301289  5.4698711 0.0186089
田中-荻野  2.0000000 -0.4698711  4.4698711 0.1226987
吉川-岸   -3.3333333 -5.8032044 -0.8634623 0.0102769
大引-岸    1.6666667 -0.8032044  4.1365377 0.2282769
田中-岸    0.6666667 -1.8032044  3.1365377 0.8766404
大引-吉川  5.0000000  2.5301289  7.4698711 0.0007714
田中-吉川  4.0000000  1.5301289  6.4698711 0.0033834
田中-大引 -1.0000000 -3.4698711  1.4698711 0.6448878
</pre>
</div>
</div>

<div id="outline-container-orgf6d29fe" class="outline-4">
<h4 id="orgf6d29fe">個人の比較には興味がないので，科目についてのみ多重比較</h4>
<div class="outline-text-4" id="text-orgf6d29fe">
<div class="org-src-container">
<pre class="src src-R">
TukeyHSD(aov(&#22909;&#24847;&#24230; ~ &#31185;&#30446; + &#20154;), <span style="color: #95e454;">"&#31185;&#30446;"</span>)

</pre>
</div>

<pre class="example" id="org7f5b703">
  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = 好意度 ~ 科目 + 人)

$科目
                  diff       lwr       upr     p adj
線形代数-確率統計  1.4 -0.182381  2.982381 0.0811694
微分積分-確率統計 -1.6 -3.182381 -0.017619 0.0477167
微分積分-線形代数 -3.0 -4.582381 -1.417619 0.0016141
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd57701" class="outline-2">
<h2 id="orgcd57701">7.2.4 平方和の分解と自由度の計算</h2>
<div class="outline-text-2" id="text-orgcd57701">
<p>
対応あり/なしでのモデルの違い
</p>

<ul class="org-ul">
<li>一元配置 (対応なし)</li>
</ul>


<p>
全体平方和 = 群間平方和 + 郡内平方和
</p>

<ul class="org-ul">
<li><p>
一元配置 (対応あり)
</p>

<p>
全体平方和 = 条件平方和 + 個人差平方和 + 残差平方和 
</p>

<ul class="org-ul">
<li><p>
条件平方和は， 対応なしの群間平方和と同じ
</p>

<p>
郡内平方和 = 個人差平方和 + 残差平方和 と考える
</p></li>
</ul></li>
</ul>


<div class="org-src-container">
<pre class="src src-R">
(&#20840;&#12487;&#12540;&#12479; <span style="color: #e5786d;">&lt;-</span> matrix(c(7,8,9,5,6,
                     5,4,7,1,3,
                     8,6, 7,2,5),nrow=5,ncol=3))
</pre>
</div>

<pre class="example">
     [,1] [,2] [,3]
[1,]    7    5    8
[2,]    8    4    6
[3,]    9    7    7
[4,]    5    1    2
[5,]    6    3    5
</pre>


<div class="org-src-container">
<pre class="src src-R">
(&#31185;&#30446;&#24179;&#22343; <span style="color: #e5786d;">&lt;-</span> colMeans(&#20840;&#12487;&#12540;&#12479;))

</pre>
</div>

<pre class="example">
[1] 7.0 4.0 5.6
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#20154;&#24179;&#22343; <span style="color: #e5786d;">&lt;-</span> rowMeans(&#20840;&#12487;&#12540;&#12479;))
</pre>
</div>

<pre class="example">
[1] 6.666667 6.000000 7.666667 2.666667 4.666667
</pre>


<div class="org-src-container">
<pre class="src src-R">
(&#20840;&#24179;&#22343; <span style="color: #e5786d;">&lt;-</span> mean(&#20840;&#12487;&#12540;&#12479;))

</pre>
</div>

<pre class="example">
[1] 5.533333
</pre>



<div class="org-src-container">
<pre class="src src-R">(&#20840;&#24179;&#22343;&#34892;&#21015; <span style="color: #e5786d;">&lt;-</span> matrix(rep(&#20840;&#24179;&#22343;,15),nrow=5,ncol=3))
</pre>
</div>

<pre class="example">
         [,1]     [,2]     [,3]
[1,] 5.533333 5.533333 5.533333
[2,] 5.533333 5.533333 5.533333
[3,] 5.533333 5.533333 5.533333
[4,] 5.533333 5.533333 5.533333
[5,] 5.533333 5.533333 5.533333
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#31185;&#30446;&#24179;&#22343;&#34892;&#21015; <span style="color: #e5786d;">&lt;-</span> matrix(rep(&#31185;&#30446;&#24179;&#22343;,5),nrow=5,ncol=3, byrow=T))
</pre>
</div>

<pre class="example">
     [,1] [,2] [,3]
[1,]    7    4  5.6
[2,]    7    4  5.6
[3,]    7    4  5.6
[4,]    7    4  5.6
[5,]    7    4  5.6
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#20154;&#24179;&#22343;&#34892;&#21015; <span style="color: #e5786d;">&lt;-</span> matrix(rep(&#20154;&#24179;&#22343;,3),nrow=5,ncol=3))
</pre>
</div>

<pre class="example">
         [,1]     [,2]     [,3]
[1,] 6.666667 6.666667 6.666667
[2,] 6.000000 6.000000 6.000000
[3,] 7.666667 7.666667 7.666667
[4,] 2.666667 2.666667 2.666667
[5,] 4.666667 4.666667 4.666667
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#20840;&#20307; <span style="color: #e5786d;">&lt;-</span> &#20840;&#12487;&#12540;&#12479; - &#20840;&#24179;&#22343;&#34892;&#21015;)
</pre>
</div>

<pre class="example">
           [,1]       [,2]       [,3]
[1,]  1.4666667 -0.5333333  2.4666667
[2,]  2.4666667 -1.5333333  0.4666667
[3,]  3.4666667  1.4666667  1.4666667
[4,] -0.5333333 -4.5333333 -3.5333333
[5,]  0.4666667 -2.5333333 -0.5333333
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#26465;&#20214; <span style="color: #e5786d;">&lt;-</span> &#31185;&#30446;&#24179;&#22343;&#34892;&#21015; - &#20840;&#24179;&#22343;&#34892;&#21015;)
</pre>
</div>

<pre class="example">
         [,1]      [,2]       [,3]
[1,] 1.466667 -1.533333 0.06666667
[2,] 1.466667 -1.533333 0.06666667
[3,] 1.466667 -1.533333 0.06666667
[4,] 1.466667 -1.533333 0.06666667
[5,] 1.466667 -1.533333 0.06666667
</pre>



<div class="org-src-container">
<pre class="src src-R">(&#20491;&#20154;&#24046; <span style="color: #e5786d;">&lt;-</span> &#20154;&#24179;&#22343;&#34892;&#21015; - &#20840;&#24179;&#22343;&#34892;&#21015;)
</pre>
</div>

<pre class="example">
           [,1]       [,2]       [,3]
[1,]  1.1333333  1.1333333  1.1333333
[2,]  0.4666667  0.4666667  0.4666667
[3,]  2.1333333  2.1333333  2.1333333
[4,] -2.8666667 -2.8666667 -2.8666667
[5,] -0.8666667 -0.8666667 -0.8666667
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#27531;&#24046; <span style="color: #e5786d;">&lt;-</span> &#20840;&#12487;&#12540;&#12479; - &#20840;&#24179;&#22343;&#34892;&#21015; - &#26465;&#20214; - &#20491;&#20154;&#24046;)

</pre>
</div>

<pre class="example">
           [,1]       [,2]        [,3]
[1,] -1.1333333 -0.1333333  1.26666667
[2,]  0.5333333 -0.4666667 -0.06666667
[3,] -0.1333333  0.8666667 -0.73333333
[4,]  0.8666667 -0.1333333 -0.73333333
[5,] -0.1333333 -0.1333333  0.26666667
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#20840;&#20307;&#24179;&#26041;&#21644; <span style="color: #e5786d;">&lt;-</span> sum(&#20840;&#20307;^2))
</pre>
</div>

<pre class="example">
[1] 73.73333
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#26465;&#20214;&#24179;&#26041;&#21644; <span style="color: #e5786d;">&lt;-</span> sum(&#26465;&#20214;^2))
</pre>
</div>

<pre class="example">
[1] 22.53333
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#20491;&#20154;&#24046;&#24179;&#26041;&#21644; <span style="color: #e5786d;">&lt;-</span> sum(&#20491;&#20154;&#24046;^2))
</pre>
</div>

<pre class="example">
[1] 45.06667
</pre>


<div class="org-src-container">
<pre class="src src-R">(&#27531;&#24046;&#24179;&#26041;&#21644; <span style="color: #e5786d;">&lt;-</span> sum(&#27531;&#24046;^2))
</pre>
</div>

<pre class="example">
[1] 6.133333
</pre>



<div class="org-src-container">
<pre class="src src-R">&#20840;&#20307;&#24179;&#26041;&#21644; - (&#26465;&#20214;&#24179;&#26041;&#21644; + &#20491;&#20154;&#24046;&#24179;&#26041;&#21644; +&#27531;&#24046;&#24179;&#26041;&#21644;)
</pre>
</div>

<pre class="example">
[1] -1.421085e-14
</pre>
</div>

<div id="outline-container-org1211cb1" class="outline-3">
<h3 id="org1211cb1">結果</h3>
<div class="outline-text-3" id="text-org1211cb1">
<p>
全体平方和 = 条件平方和 + 個人差平方和 + 残差平方和 となること確か
めた
</p>

<p>
自由度   
</p>
<ul class="org-ul">
<li>条件の自由度 = 条件の数 - 1 = 2</li>
<li>個人差の自由度 = 人数 - 1 = 4</li>
<li>残差の自由度 = 条件の自由度 * 個人差の自由度 = 2 * 4 = 8</li>
<li>全体の自由度 = 全データ数 - 1 = 14</li>
</ul>


<p>
全体の自由度 = 条件の自由度 + 個人差の自由度 + 残差の自由度 がなり
たつ
</p>
</div>
</div>
</div>


<div id="outline-container-org998e912" class="outline-2">
<h2 id="org998e912">7.3 二元配置分散分析 (対応なし)</h2>
<div class="outline-text-2" id="text-org998e912">
<ul class="org-ul">
<li>対応のない二元配置分散分析</li>
<li>2要因とも対応のある二元配置分散分析</li>
<li>1要因のみ対応のある二元配置分散分析</li>
</ul>
</div>

<div id="outline-container-org481d14f" class="outline-3">
<h3 id="org481d14f">例題</h3>
<div class="outline-text-3" id="text-org481d14f">
</div>
<div id="outline-container-org6f1260a" class="outline-4">
<h4 id="org6f1260a">ミネラルウォーターの美味しさの評定に関する実験データ:</h4>
<div class="outline-text-4" id="text-org6f1260a">
<ul class="org-ul">
<li>3銘柄のミネラルウォーターについて，</li>

<li>2種類の温度条件のもとで，</li>

<li>6通りの条件があり，</li>

<li>各条件について5人の評定者，合計30人の評定者による評点</li>
</ul>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">冷蔵庫</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">常温</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-right">イカアン</td>
<td class="org-right">ボスビック</td>
<td class="org-right">ビビッテル</td>
<td class="org-right">イカアン</td>
<td class="org-right">ボスビック</td>
<td class="org-right">ビビッテル</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">10</td>
<td class="org-right">11</td>
<td class="org-right">5</td>
<td class="org-right">7</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">8</td>
<td class="org-right">12</td>
<td class="org-right">4</td>
<td class="org-right">6</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">10</td>
<td class="org-right">12</td>
<td class="org-right">2</td>
<td class="org-right">5</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">8</td>
<td class="org-right">10</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">9</td>
<td class="org-right">10</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orge547915" class="outline-4">
<h4 id="orge547915">検定内容</h4>
<div class="outline-text-4" id="text-orge547915">
<p>
銘柄の違いや温度の違いにより，おいしさの評点の母平均は異なるか？
</p>
</div>
</div>

<div id="outline-container-orgb5bb48d" class="outline-4">
<h4 id="orgb5bb48d">データの準備</h4>
<div class="outline-text-4" id="text-orgb5bb48d">
<div class="org-src-container">
<pre class="src src-R"> &#21619; <span style="color: #e5786d;">&lt;-</span> c(6,4,5,3,2,10,8,10,8,9,11,12,12,10,10,5,4,2,2,2,7,6,5,4,3,12,8,5,6,4)
 &#28201;&#24230; <span style="color: #e5786d;">&lt;-</span> factor(c(rep(<span style="color: #95e454;">"&#20919;&#34101;&#24235;"</span>,15),rep(<span style="color: #95e454;">"&#24120;&#28201;"</span>,15)))
 &#37528;&#26564; <span style="color: #e5786d;">&lt;-</span> factor(rep(c(rep(<span style="color: #95e454;">"&#12452;&#12459;&#12450;&#12531;"</span>,5),rep(<span style="color: #95e454;">"&#12508;&#12473;&#12499;&#12483;&#12463;"</span>,5),rep(<span style="color: #95e454;">"&#12499;&#12499;&#12483;&#12486;&#12523;"</span>,5)),2))
 &#28201;&#24230; <span style="color: #e5786d;">&lt;-</span> factor(c(rep(<span style="color: #95e454;">"&#20919;&#34101;&#24235;"</span>,15),rep(<span style="color: #95e454;">"&#24120;&#28201;"</span>,15)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org793a05d" class="outline-3">
<h3 id="org793a05d">7.3.1 主効果と交互作用効果</h3>
<div class="outline-text-3" id="text-org793a05d">
<p>
ミネラルウォーターの美味しさに関する実験では，母平均に違いがあると考え
られている (対立仮説)
</p>

<p>
違いの:
</p>
<dl class="org-dl">
<dt>要因</dt><dd>母平均に違いをもたらす原因</dd>
<dt>水準</dt><dd>ある要因の中に含まれる個々の条件</dd>
</dl>

<p>
例題では;
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">要因</th>
<th scope="col" class="org-left">水準</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">温度の違い</td>
<td class="org-left">冷蔵、　常温</td>
</tr>

<tr>
<td class="org-left">銘柄の違い</td>
<td class="org-left">イカアン、ボスビック、ビビッテル</td>
</tr>
</tbody>
</table>

<p>
二元配置分散分析では、主効果と交互作用効果という2種類の効果を考える
</p>

<dl class="org-dl">
<dt>主効果</dt><dd><p>
それぞれの要因ごとの効果
</p>

<p>
一元配置分散分析のときに考えた効果と同じ
</p></dd>

<dt>交互作用効果</dt><dd><p>
2つ以上の要因が組み合わされたときに生じる効果
</p>

<p>
2つの要因の効果の単純な足し算では説明できない効果 
</p></dd>
</dl>
</div>
</div>


<div id="outline-container-org301d6e1" class="outline-3">
<h3 id="org301d6e1">7.3.2 対応のない二元配置分散分析</h3>
<div class="outline-text-3" id="text-org301d6e1">
</div>
<div id="outline-container-org51571fa" class="outline-4">
<h4 id="org51571fa">手順の確認:</h4>
<div class="outline-text-4" id="text-org51571fa">
<ul class="org-ul">
<li>帰無仮説と対立仮説の設定</li>
<li>検定統計量の選択: 分散分析では、検定統計値としてＦを利用</li>
<li>有意水準 \(\alpha\) の決定: 有意水準は5％、つまりα＝0.05とする。この検定は片側検定</li>
<li><p>
検定統計量の実現値を求める
</p>

<p>
aov関数を用いて実現値を求める
</p></li>

<li>帰無仮説の棄却or採択の決定</li>
</ul>
</div>
</div>

<div id="outline-container-orgf8a6e51" class="outline-4">
<h4 id="orgf8a6e51">二元配置分散分析</h4>
<div class="outline-text-4" id="text-orgf8a6e51">
<ul class="org-ul">
<li>帰無仮説と対立仮説の設定
　
<ul class="org-ul">
<li>要因A (温度の違い)の主効果
<dl class="org-dl">
<dt>帰無仮説 \(H_0\)</dt><dd>温度が違ってもおいしさ得点の母平均は等しい（要因Ａの主効果はない）</dd>
<dt>対立仮説 \(H_1\)</dt><dd>温度の違いによっておいしさ得点の母平均は異なる（要因Ａの主効果がある）</dd>
</dl></li>

<li>要因B (銘柄の違い) の主効果
<dl class="org-dl">
<dt>帰無仮説 \(H_0\)</dt><dd>銘柄が違ってもおいしさ得点の母平均は等しい(要因Bの主効果はない)</dd>
<dt>対立仮説 \(H_1\)</dt><dd>銘柄の違いによっておいしさ得点の母平均は異なる(要因Bの主効果がある)</dd>
</dl></li>

<li>要因Aと要因Bの交互作用効果
<dl class="org-dl">
<dt>帰無仮説 \(H_0\)</dt><dd>温度と銘柄の組み合わせによるおいしさ
得点の影響はない(要因Aと要因Bの交互作用効果はない)</dd>
<dt>対立仮説 \(H_1\)</dt><dd>温度と銘柄の組み合わせによるおいしさ
得点の影響がある(要因Aと要因Bの交互作用効果がある)</dd>
</dl></li>
</ul></li>

<li id="検定統計量の選択">Fを検定統計量とする</li>
<li id="有意水準 \(\alpha\) の決定">ここでは有意水準は5%、つまり \(\alpha=0.05\)とする。片側検定である</li>
<li>検定統計量の実現値を求める: ここでは、最も一般的なaov関数を用いる</li>
</ul>


<div class="org-src-container">
<pre class="src src-R"> &#21619; <span style="color: #e5786d;">&lt;-</span> c(6,4,5,3,2,10,8,10,8,9,11,12,12,10,10,5,4,2,2,2,7,6,5,4,3,12,8,5,6,4)
 &#28201;&#24230; <span style="color: #e5786d;">&lt;-</span> factor(c(rep(<span style="color: #95e454;">"&#20919;&#34101;&#24235;"</span>,15),rep(<span style="color: #95e454;">"&#24120;&#28201;"</span>,15)))
 &#37528;&#26564; <span style="color: #e5786d;">&lt;-</span> factor(rep(c(rep(<span style="color: #95e454;">"&#12452;&#12459;&#12450;&#12531;"</span>,5),rep(<span style="color: #95e454;">"&#12508;&#12473;&#12499;&#12483;&#12463;"</span>,5),rep(<span style="color: #95e454;">"&#12499;&#12499;&#12483;&#12486;&#12523;"</span>,5)),2))
 summary(aov(&#21619;~&#28201;&#24230;*&#37528;&#26564;))
</pre>
</div>

<pre class="example">
            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
温度         1   67.5   67.50  21.316  0.00011 ***
銘柄         2  155.0   77.50  24.474 1.61e-06 ***
温度:銘柄    2   15.0    7.50   2.368  0.11515    
Residuals   24   76.0    3.17                     
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>


<p>
<a href="https://qiita.com/saka212/items/754635486c6be0e3100b">統計検定のための、Rの出力結果からわかること（分散分析編） - Qiita</a>
<a href="https://qiita.com/saka212/items/8c74854171775e5d5273">統計検定のための、Rの出力結果からわかること（回帰分析編） - Qiita</a>
</p>

<ul class="org-ul">
<li>帰無仮説の棄却or採択の決定:
<ul class="org-ul">
<li>温度の主効果：5％水準で有意な効果がある (p=0.0011 = 1.1×10-4）</li>
<li>銘柄の主効果：5％水準で有意な効果がある (p=1.6×10-6）</li>
<li>温度と銘柄の交互作用効果：5％水準で有意な効果はない（p=0.115）</li>
</ul></li>

<li>関数による交互作用効果の図:</li>
</ul>


<div class="org-src-container">
<pre class="src src-R">        interaction.plot(&#28201;&#24230;,&#37528;&#26564;,&#21619;)
</pre>
</div>


<div id="orgfad1aa4" class="figure">
<p><img src="RforS/graph/07-03-1.png" alt="07-03-1.png" />
</p>
</div>

<p>
[温度ごとの銘柄と味との関係の図]
</p>
<div class="org-src-container">
<pre class="src src-R">    interaction.plot(&#37528;&#26564;,&#28201;&#24230;,&#21619;)
</pre>
</div>


<div id="orgd5d2805" class="figure">
<p><img src="RforS/graph/07-03-2.png" alt="07-03-2.png" />
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-org2d2acfb" class="outline-3">
<h3 id="org2d2acfb">7.3.3 一元配置分散分析との比較</h3>
<div class="outline-text-3" id="text-org2d2acfb">
<p>
一元配置分散分析をしてみる：
</p>

<div class="org-src-container">
<pre class="src src-R">summary(aov(&#21619;~&#28201;&#24230;))
</pre>
</div>

<pre class="example">
            Df Sum Sq Mean Sq F value Pr(&gt;F)   
温度         1   67.5   67.50   7.683 0.0098 **
Residuals   28  246.0    8.79                  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>



<div class="org-src-container">
<pre class="src src-R">summary(aov(&#21619;~&#37528;&#26564;))
</pre>
</div>

<pre class="example">
            Df Sum Sq Mean Sq F value Pr(&gt;F)    
銘柄         2  155.0   77.50    13.2  1e-04 ***
Residuals   27  158.5    5.87                   
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre>
</div>

<div id="outline-container-orgd9dc3c8" class="outline-4">
<h4 id="orgd9dc3c8">結果</h4>
<div class="outline-text-4" id="text-orgd9dc3c8">
<ul class="org-ul">
<li>いずれも有意な差がある，ことは得られているが，</li>
<li><p>
p値に違いがあり，
</p>

<p>
一元配置の方が大きい
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org0c01ce9" class="outline-4">
<h4 id="org0c01ce9">二元配置分散分析の利点</h4>
<div class="outline-text-4" id="text-org0c01ce9">
<ol class="org-ol">
<li>二つの要因について同時に検討するだけでなく，</li>

<li><p>
残渣のばらつき(平方和) を減らせるので，
</p>

<p>
要因毎に有意な結果を得られやすくする
</p></li>
</ol>
</div>
</div>
</div>
</div>


<div id="outline-container-org54742dc" class="outline-2">
<h2 id="org54742dc">7.4 二要因とも対応のある二元配置分散分析</h2>
<div class="outline-text-2" id="text-org54742dc">
</div>
<div id="outline-container-orga8709ac" class="outline-3">
<h3 id="orga8709ac">例題：</h3>
<div class="outline-text-3" id="text-orga8709ac">
<p>
ミネラルウォーターの美味しさの５人の評定者による評定データ(前の例題の表に評定者データを加えたもの):
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-right">冷蔵庫</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">常温</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">評定者</td>
<td class="org-right">イカアン</td>
<td class="org-right">ボスビック</td>
<td class="org-right">ビビッテル</td>
<td class="org-right">イカアン</td>
<td class="org-right">ボスビック</td>
<td class="org-right">ビビッテル</td>
</tr>

<tr>
<td class="org-left">村松</td>
<td class="org-right">6</td>
<td class="org-right">10</td>
<td class="org-right">11</td>
<td class="org-right">5</td>
<td class="org-right">7</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-left">川崎</td>
<td class="org-right">4</td>
<td class="org-right">8</td>
<td class="org-right">12</td>
<td class="org-right">4</td>
<td class="org-right">6</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-left">井口</td>
<td class="org-right">5</td>
<td class="org-right">10</td>
<td class="org-right">12</td>
<td class="org-right">2</td>
<td class="org-right">5</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-left">松中</td>
<td class="org-right">3</td>
<td class="org-right">8</td>
<td class="org-right">10</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-left">城島</td>
<td class="org-right">2</td>
<td class="org-right">9</td>
<td class="org-right">10</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>

<p>
同じ評定者が、温度と銘柄のそれぞれの要因の組合わせに対して評定を下す
</p>

<div class="org-src-container">
<pre class="src src-R">
<span style="color: #99968b;"># </span><span style="color: #99968b;">&#22793;&#25968;&#12300;&#21619;&#12301;, &#12300;&#28201;&#24230;&#12301;, &#12300;&#37528;&#26564;&#12301; &#12399;&#21069;&#12398;&#20363;&#38988;&#12398;&#12418;&#12398;&#12434;&#20351;&#12358;</span>
 &#20154;1 <span style="color: #e5786d;">&lt;-</span> factor(rep(c(<span style="color: #95e454;">"&#26449;&#26494;"</span>,<span style="color: #95e454;">"&#24029;&#23822;"</span>,<span style="color: #95e454;">"&#20117;&#21475;"</span>,<span style="color: #95e454;">"&#26494;&#20013;"</span>,<span style="color: #95e454;">"&#22478;&#23798;"</span>),6))            <span style="color: #99968b;"># </span><span style="color: #99968b;">&#35413;&#23450;&#36554;&#12398;&#24773;&#22577;</span>
 &#25968;&#23383;1D1 <span style="color: #e5786d;">&lt;-</span> factor(rep(1:5,6))          <span style="color: #99968b;"># </span><span style="color: #99968b;">&#35413;&#23450;&#32773;&#21517;&#12398;&#20195;&#12431;&#12426;&#12395;&#25968;&#23383;&#12434;&#20351;&#12358;&#22580;&#21512;</span>

summary(aov(&#21619;~&#28201;&#24230;*&#37528;&#26564;                        <span style="color: #99968b;"># </span><span style="color: #99968b;">&#23550;&#24540;&#12398;&#12394;&#12356;&#22580;&#21512;&#12392;&#21516;&#12376;</span>
        +Error(&#20154;1+&#20154;1:&#28201;&#24230;+&#20154;1:&#37528;&#26564;+&#20154;1:&#28201;&#24230;:&#37528;&#26564;)))  <span style="color: #99968b;"># </span><span style="color: #99968b;">&#20491;&#20154;&#24046;&#12395;&#12424;&#12427;&#12487;&#12540;&#12479;&#12398;&#20998;&#26512;</span>

aov(&#21619;~&#28201;&#24230;*&#37528;&#26564;                        <span style="color: #99968b;"># </span><span style="color: #99968b;">&#23550;&#24540;&#12398;&#12394;&#12356;&#22580;&#21512;&#12392;&#21516;&#12376;</span>
        +Error(&#20154;1+&#20154;1:&#28201;&#24230;+&#20154;1:&#37528;&#26564;+&#20154;1:&#28201;&#24230;:&#37528;&#26564;))  <span style="color: #99968b;"># </span><span style="color: #99968b;">&#20491;&#20154;&#24046;&#12395;&#12424;&#12427;&#12487;&#12540;&#12479;&#12398;&#20998;&#26512;</span>
</pre>
</div>

<pre class="example" id="orgd642516">

Error: 人1
          Df Sum Sq Mean Sq F value Pr(&gt;F)
Residuals  4     45   11.25               

Error: 人1:温度
          Df Sum Sq Mean Sq F value Pr(&gt;F)  
温度       1   67.5   67.50      18 0.0132 *
Residuals  4   15.0    3.75                 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Error: 人1:銘柄
          Df Sum Sq Mean Sq F value   Pr(&gt;F)    
銘柄       2    155    77.5     155 4.01e-07 ***
Residuals  8      4     0.5                     
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Error: 人1:温度:銘柄
          Df Sum Sq Mean Sq F value Pr(&gt;F)  
温度:銘柄  2     15     7.5       5  0.039 *
Residuals  8     12     1.5                 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

</pre>

<p>
この例題の場合、「対応がある」ということは『個人差』によるデータのばら
つきを分析することができる、ということ。
</p>

<p>
したがって(個人差のばらつきを除くことにより)、
</p>
<ul class="org-ul">
<li>温度の主効果、</li>
<li>銘柄の主効果、</li>
<li><p>
温度と銘柄の交互作用の効果の分析が得られる。
</p>

<p>
上の結果は、いずれも有意であることが示されている
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org27bb92e" class="outline-3">
<h3 id="org27bb92e">対応なしの場合の分析結果と比較してみましょう。</h3>
<div class="outline-text-3" id="text-org27bb92e">
<ol class="org-ol">
<li>帰無仮説の棄却or採択の決定:

<ul class="org-ul">
<li>温度の主効果：5％水準で有意な効果がある (p=0.0132）(P=0.00011)</li>
<li>銘柄の主効果：5％水準で有意な効果がある (p=4.01e-7) (p=1.6×10-6）</li>
<li>温度と銘柄の交互作用効果：5％水準で有意な効果がある（p=0.039)
対応なしでは，(p=0.11515) で有意な効果はなかった</li>
</ul></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orga22cc82" class="outline-2">
<h2 id="orga22cc82">7.5 一要因のみ対応のある二元配置分散分析</h2>
<div class="outline-text-2" id="text-orga22cc82">
<p>
例題：ミネラルウォーターの美味しさについての評定データ(一つ前の例題の表に評定者データを加えたもの):
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-right">冷蔵庫</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">常温</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-left">評定者</td>
<td class="org-right">イカアン</td>
<td class="org-right">ボスビック</td>
<td class="org-right">ビビッテル</td>
<td class="org-left">評定者</td>
<td class="org-right">イカアン</td>
<td class="org-right">ボスビック</td>
<td class="org-right">ビビッテル</td>
</tr>

<tr>
<td class="org-left">村松</td>
<td class="org-right">6</td>
<td class="org-right">10</td>
<td class="org-right">11</td>
<td class="org-left">斉藤</td>
<td class="org-right">5</td>
<td class="org-right">7</td>
<td class="org-right">12</td>
</tr>

<tr>
<td class="org-left">川崎</td>
<td class="org-right">4</td>
<td class="org-right">8</td>
<td class="org-right">12</td>
<td class="org-left">和田</td>
<td class="org-right">4</td>
<td class="org-right">6</td>
<td class="org-right">8</td>
</tr>

<tr>
<td class="org-left">井口</td>
<td class="org-right">5</td>
<td class="org-right">10</td>
<td class="org-right">12</td>
<td class="org-left">寺原</td>
<td class="org-right">2</td>
<td class="org-right">5</td>
<td class="org-right">5</td>
</tr>

<tr>
<td class="org-left">松中</td>
<td class="org-right">3</td>
<td class="org-right">8</td>
<td class="org-right">10</td>
<td class="org-left">杉内</td>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">6</td>
</tr>

<tr>
<td class="org-left">城島</td>
<td class="org-right">2</td>
<td class="org-right">9</td>
<td class="org-right">10</td>
<td class="org-left">新垣</td>
<td class="org-right">2</td>
<td class="org-right">3</td>
<td class="org-right">4</td>
</tr>
</tbody>
</table>


<p>
評定
</p>

<ul class="org-ul">
<li>冷蔵庫と常温では異なる評定者が評定する</li>
<li>同じ温度に対しては同じ評定者が銘柄のそれぞれの要因の組合わせに対して評
定を下す</li>
</ul>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #99968b;"># </span><span style="color: #99968b;">&#22793;&#25968;&#12300;&#21619;&#12301;, &#12300;&#28201;&#24230;&#12301;, &#12300;&#37528;&#26564;&#12301; &#12399;&#21069;&#12398;&#20363;&#38988;&#12398;&#12418;&#12398;&#12434;&#20351;&#12358;</span>
 A1&#26465;&#20214; <span style="color: #e5786d;">&lt;-</span> rep(c(<span style="color: #95e454;">"&#26449;&#26494;"</span>,<span style="color: #95e454;">"&#24029;&#23822;"</span>,<span style="color: #95e454;">"&#20117;&#21475;"</span>,<span style="color: #95e454;">"&#26494;&#20013;"</span>,<span style="color: #95e454;">"&#22478;&#23798;"</span>),3)
 A2&#26465;&#20214; <span style="color: #e5786d;">&lt;-</span> rep(c(<span style="color: #95e454;">"&#25993;&#34276;"</span>,<span style="color: #95e454;">"&#21644;&#30000;"</span>,<span style="color: #95e454;">"&#23546;&#21407;"</span>,<span style="color: #95e454;">"&#26441;&#20869;"</span>,<span style="color: #95e454;">"&#26032;&#22435;"</span>),3)
 &#20154;2 <span style="color: #e5786d;">&lt;-</span> factor(c(A1&#26465;&#20214;, A2&#26465;&#20214;))
 &#25968;&#23383;ID2 <span style="color: #e5786d;">&lt;-</span> factor(c(rep(1:5,3),rep(6:10,3)))           <span style="color: #99968b;"># </span><span style="color: #99968b;">&#35413;&#23450;&#32773;&#21517;&#12398;&#20195;&#12431;&#12426;&#12395;&#25968;&#23383;&#12434;&#20351;&#12358;&#22580;&#21512;      </span>
 summary(aov(&#21619;~&#28201;&#24230;*&#37528;&#26564;                    <span style="color: #99968b;"># </span><span style="color: #99968b;">&#23550;&#24540;&#12398;&#12394;&#12356;&#22580;&#21512;&#12392;&#21516;&#12376;</span>
                  +Error(&#20154;2:&#28201;&#24230;+&#20154;2:&#28201;&#24230;:&#37528;&#26564;)))              <span style="color: #99968b;"># </span><span style="color: #99968b;">&#36861;&#21152;&#12373;&#12428;&#12383;&#12458;&#12503;&#12471;&#12519;&#12531;</span>
</pre>
</div>

<pre class="example" id="org019efe9">

Error: 人2:温度
          Df Sum Sq Mean Sq F value Pr(&gt;F)  
温度       1   67.5    67.5       9 0.0171 *
Residuals  8   60.0     7.5                 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Error: 人2:温度:銘柄
          Df Sum Sq Mean Sq F value   Pr(&gt;F)    
銘柄       2    155    77.5    77.5 5.87e-09 ***
温度:銘柄  2     15     7.5     7.5  0.00504 ** 
Residuals 16     16     1.0                     
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
 警告メッセージ: 
 aov(味 ~ 温度 * 銘柄 + Error(人2:温度 + 人2:温度:銘柄)) で: 
  Error() model is singular
</pre>


<p>
対応のない分散分析で「残差」としてまとめられていたものを次の要因に分解
</p>

<dl class="org-dl">
<dt>人2:温度</dt><dd>人2と温度の交互効果</dd>
<dt>人2:温度:銘柄</dt><dd>人2と温度と銘柄の交互効果</dd>
</dl>

<p>
各評定者は同じ温度の条件で３種類の銘柄を飲んでいるため，
個人差の要因となる。
</p>

<p>
だから、個人差の要因である「人2」と温度の違いの要因をあらわす「温度」
が関係する組み合わせだけを指定する
</p>

<p>
この分析の結果、「温度」の主効果と「銘柄」の主効果、「温度」と「銘柄」
の交互作用効果に有意差が認められている
</p>
</div>

<div id="outline-container-org6daf53b" class="outline-3">
<h3 id="org6daf53b">拡張</h3>
<div class="outline-text-3" id="text-org6daf53b">
<ul class="org-ul">
<li>同様に、三元配置、四元配置、&#x2026;要因を増やして分析することが可能</li>
<li>ただし、要因の数が多いと、分析が複雑になり、結果の解釈が困難になることがあるので注意</li>
<li><p>
分散分析は、基本的に平均値の比較の検定
</p>

<p>
主効果や交互作用効果の観点からデータにおける値のばらつきの分析が可能
</p></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: suzuki@iwate-u.ac.jp 鈴木正幸，非常勤講師</p>
<p class="date">Created: 2022-01-24 月 10:39</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
